clear; close all; clc

%% Find circle containing image
r = 2048;
c = 2048;
xc = r/2;
yc = c/2;
circ = false(r, c);
for x = 1:r
    for y = 1:c
        if (x-xc)^2 + (y-yc)^2 <= xc^2
            circ(x, y) = 1;
        end
    end
end

basePath = 'eScience/XRay/apu05.esci.nbi.dk.0_localhost/tandlaege/disc_backups/disc2/volfloat/';
fileNames = {'5.05_ID1662_769_0001.vol', '5.05_ID1662_769_0002.vol', ...
'5.05_ID1662_769_0003.vol', '5.05_ID1662_769_0004.vol', '5.05_ID1662_770_0001.vol', ...
'5.05_ID1662_770_0002.vol', '5.05_ID1662_770_0003.vol', '5.05_ID1662_770_0004.vol', ...
'5.05_ID1662_771_0001.vol', '5.05_ID1662_771_0002.vol', '5.05_ID1662_771_0003.vol', ...
'5.05_ID1662_771_0004.vol', '5.05_ID1662_772_0001.vol', '5.05_ID1662_772_0002.vol', ...
'5.05_ID1662_772_0003.vol', '5.05_ID1662_772_0004.vol', '5.05_ID1662_773_0001.vol', ...
'5.05_ID1662_773_0002.vol', '5.05_ID1662_773_0003.vol', '5.05_ID1662_773_0004.vol', ...
'5.05_ID1684_806_0001.vol', '5.05_ID1684_806_0002.vol', '5.05_ID1684_806_0003.vol', ...
'5.05_ID1684_806_0004.vol', '5.05_ID1684_809_0001.vol', '5.05_ID1684_809_0002.vol', ...
'5.05_ID1684_809_0003.vol', '5.05_ID1684_809_0004.vol', '5.05_ID1689_805_0001.vol', ...
'5.05_ID1689_805_0002.vol', '5.05_ID1689_805_0003.vol', '5.05_ID1689_805_0004.vol', ...
'5.05_ID1689_807_0001.vol', '5.05_ID1689_807_0002.vol', '5.05_ID1689_807_0003.vol', ...
'5.05_ID1689_807_0004.vol', '5.05_ID1689_808_0001.vol', '5.05_ID1689_808_0002.vol', ...
'5.05_ID1689_808_0003.vol', '5.05_ID1689_808_0004.vol'};

N = 100;
intensity = zeros(1, N);
for ii = 1:length(fileNames)
    for jj = 1:255
        % disp(jj/255)
        img = loadGed([basePath fileNames{ii}], jj);
        intensity = intensity + intensityCurveFun(img, circ, N);
    end
end
intensity = intensity/100;
save('intensity.mat', 'intensity')
